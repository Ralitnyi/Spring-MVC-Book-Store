<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  lang="en"
  th:replace="~{layout :: layout}"
>
  <head>
    <title>Cart</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-param" content="_csrf" />
    <meta name="csrf-header" content="X-CSRF-TOKEN" />
  </head>
  <body>
    <div th:fragment="content">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 m-0">Your Cart</h1>
      </div>

      <div th:if="${#lists.isEmpty(items)}" class="alert alert-info">
        Cart is empty.
      </div>

      <div th:if="${!#lists.isEmpty(items)}" class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Book</th>
              <th style="width: 160px">Quantity</th>
              <th style="width: 140px">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="item : ${items}">
              <td th:text="${item.bookName}">Book</td>
              <td>
                <form
                  th:action="@{/cart/update}"
                  method="post"
                  class="d-flex gap-2"
                >
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                  <input
                    type="hidden"
                    name="name"
                    th:value="${item.bookName}"
                  />
                  <input
                    class="form-control"
                    type="number"
                    min="1"
                    name="quantity"
                    th:value="${item.quantity}"
                  />
                  <button type="submit" class="btn btn-sm btn-outline-primary">
                    Update
                  </button>
                </form>
              </td>
              <td>
                <form th:action="@{/cart/remove}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                  <input
                    type="hidden"
                    name="name"
                    th:value="${item.bookName}"
                  />
                  <button type="submit" class="btn btn-sm btn-outline-danger">
                    Remove
                  </button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="d-flex justify-content-between">
          <div class="fs-5">
            Total:
            <span
              class="fw-semibold"
              th:text="${#numbers.formatDecimal(total, 1, 2)} + '$'"
              >0.00$</span
            >
          </div>
          <form th:action="@{/orders/submit}" method="post">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="btn btn-success">Submit Order</button>
          </form>
        </div>
      </div>

      <div class="mt-3">
        <a class="btn btn-outline-secondary" th:href="@{/books}"
          >Continue shopping</a
        >
      </div>
    </div>
  </body>
</html>
